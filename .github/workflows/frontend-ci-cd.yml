name: Frontend CI/CD

on:
  push:
    branches:
      - main
      - develop
    paths:
      - 'client/**'
      - '.github/workflows/frontend-ci-cd.yml'
  pull_request:
    branches:
      - main
      - develop
    paths:
      - 'client/**'

jobs:
  build:
    name: Build and Test Frontend
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: client/package-lock.json

      - name: Install dependencies
        working-directory: ./client
        run: npm ci

      - name: Build application
        working-directory: ./client
        env:
          VITE_SOCKET_URL: ${{ secrets.VITE_SOCKET_URL || 'http://localhost:5000' }}
        run: npm run build

      - name: Check build output
        working-directory: ./client
        run: |
          if [ -d "dist" ]; then
            echo "Build successful - dist directory created"
            ls -la dist
          else
            echo "Build failed - dist directory not found"
            exit 1
          fi

  deploy:
    name: Deploy to Vercel
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deploy to Vercel
        run: |
          echo "Deployment will be handled by Vercel's GitHub integration"
          echo "Make sure to connect your Vercel project to this GitHub repository"
          echo "Vercel will automatically deploy when changes are pushed to main branch"
