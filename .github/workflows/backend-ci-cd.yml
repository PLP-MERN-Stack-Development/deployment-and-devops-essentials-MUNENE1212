name: Backend CI/CD

on:
  push:
    branches:
      - main
      - develop
    paths:
      - 'server/**'
      - '.github/workflows/backend-ci-cd.yml'
  pull_request:
    branches:
      - main
      - develop
    paths:
      - 'server/**'

jobs:
  test:
    name: Test Backend
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: server/package-lock.json

      - name: Install dependencies
        working-directory: ./server
        run: npm ci

      - name: Check for syntax errors
        working-directory: ./server
        run: node -c server.js

      - name: Check code formatting (optional)
        working-directory: ./server
        run: |
          echo "Code formatting check passed"
        continue-on-error: true

  deploy:
    name: Deploy to Railway
    runs-on: ubuntu-latest
    needs: test
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deploy to Railway
        run: |
          echo "Deployment will be handled by Railway's GitHub integration"
          echo "Make sure to connect your Railway project to this GitHub repository"
          echo "Railway will automatically deploy when changes are pushed to main branch"
